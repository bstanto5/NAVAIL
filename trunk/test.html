<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>jQuery testing</title>
    <link rel="stylesheet" type="text/css" media="screen" href="editor-resources/editor.css" />
    <script src="editor-resources/jquery-latest.min.js" type="text/javascript"></script>
    <script src="editor-resources/jquery.event.drag-1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
    
    var WMEditor = {};
    
    WMEditor.version = "0.96";
    WMEditor.mapfilename = "simple.conf";
    WMEditor.lastserial = 0;
    
    WMEditor.ajaxstart = function() {
        $(this).css({border: 'red 2px solid'});
    };
    
    WMEditor.ajaxstop = function() {
        $(this).css({border: 'none'});
    };
    
    WMEditor.maploader = function(json) {
        console.log(json.serial);
        WMEditor.map = json;
        if(json.valid==1)
        {
            console.log("Loaded version " + WMEditor.map.serial);
            WMEditor.lastserial = WMEditor.map.serial;
            var newbg = WMEditor.map.map.mapcache + "?" + Math.random();
            console.log("Setting background to " + newbg);
            $('img#existingdata').attr("src",newbg);
        }
        else
        {
            console.log("JSON loaded, but invalid?");
        }
        console.log("Done with maploader");
    }
    
    WMEditor.btn_refresh = function() {
        $.getJSON("editor-backend.php",
            { map: WMEditor.mapfilename, "cmd": "dump_map", "serial": WMEditor.lastserial },
            WMEditor.maploader);
    };
    
    $(document).ready( function() {
        
        $("body").ajaxStart(WMEditor.ajaxstart);
        $("body").ajaxStop(WMEditor.ajaxstop);
                    
        $('#btn_refresh').click(WMEditor.btn_refresh);
                    
        $('#toolbar').show();
        $('#themap').show();  
        
    } );
    
    </script>
    <style type="text/css">
    </style>
</head>
<body>

    <div id="toolbar">
        <span id="filenameholder">Editing <strong id="filename">blah.conf</strong></span>
        <span id="version">PHP Network Weathermap version 0.95</span>
        <ul id="tblist">
                <li><a id="btn_selectfile" class="tb_button" href="#">Change File</a></li>
                <li><a id="btn_refresh" class="tb_button" href="#">Refresh Map</a></li>
                <li><a id="btn_addnode" class="tb_button" href="#">Add Node</a></li>
                <li><a id="btn_addlink" class="tb_button" href="#">Add Link</a></li>
                <li class="tb_help">click on a node to change it's properties</li>
        </ul>
            <img width="16" height="16" src="editor-resources/indicator.gif" title="Application Is Busy" alt="Application Is Busy" id="busy" />
    </div>
    <div id="mainpage">
        <div id="themap">
            <div id="nodecontainer"></div>
            <img src="weathermap.png" id="existingdata" alt="Weathermap" usemap="#weathermap_imap"  />
        </div>
    
        <map id="weathermap_imap" name="weathermap_imap"></map>
    </div>
</body>
</html>
